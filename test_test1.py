# Generated by Selenium IDE
import pytest
import time
import json
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.desired_capabilities import DesiredCapabilities
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
import os
import random

class TestTest1():
  def setup_method(self, method):
        chrome_options = Options()

        # Táº¡o thÆ° má»¥c profile riÃªng cho Selenium
        custom_profile = r"D:\selenium_profile"
        os.makedirs(custom_profile, exist_ok=True)

        chrome_options.add_argument(f"--user-data-dir={custom_profile}")
        chrome_options.add_argument("--profile-directory=Profile 1")  # cÃ³ thá»ƒ Ä‘áº·t tÃªn khÃ¡c

        # TÃ¹y chá»n: trÃ¡nh cáº£nh bÃ¡o automation
        chrome_options.add_experimental_option("excludeSwitches", ["enable-automation"])
        chrome_options.add_experimental_option("useAutomationExtension", False)

        # TÃ¹y chá»n: khÃ´ng Ä‘Ã³ng trÃ¬nh duyá»‡t ngay khi cháº¡y xong
        chrome_options.add_experimental_option("detach", True)
        # chrome_options.add_argument("--incognito")
        # Má»Ÿ trÃ¬nh duyá»‡t
        self.driver = webdriver.Chrome(options=chrome_options)
        print("ChromeDriver version:", self.driver.capabilities['browserVersion'])
        print("Driver session started")

        self.driver.maximize_window()
        self.vars = {}
  
  def teardown_method(self, method):
    self.driver.quit()
  
  def test_test1(self):
    # Test name: test_1
    # Step # | name | target | value
    # 1 | open | /forms/d/e/1FAIpQLScfnbNpqD8HBYFvae7ImE-yTxvJnGsefKG5VXTsVkGpUYvM1A/viewform | 
    
    # 2 | setWindowSize | 1061x816 | 
    # self.driver.set_window_size(1061, 816)
    # time.sleep(2)
    # 3 | click | css=.kCyAyd .NPEfkd | 
    # self.driver.find_element(By.CSS_SELECTOR, ".kCyAyd .NPEfkd").click()
    # time.sleep(2)
    # 4 | click | css=.qs41qe .NPEfkd | 
    # self.driver.find_element(By.CSS_SELECTOR, ".uArJ5e.UQuaGc.kCyAyd.ARrCac").click()
    # time.sleep(2)
    # button = self.driver.find_element(By.CSS_SELECTOR, ".uArJ5e.UQuaGc.kCyAyd.ARrCac")
    # self.driver.execute_script("arguments[0].click();", button)
    # 5 | click | css=.YhQJj > .l4V7wb | 
    # self.driver.get("https://docs.google.com/forms/d/e/1FAIpQLScfnbNpqD8HBYFvae7ImE-yTxvJnGsefKG5VXTsVkGpUYvM1A/viewform")
    # time.sleep(2)
    
    
    # 6 | click | css=.whsOnd | 
    # self.driver.find_element(By.CSS_SELECTOR, ".whsOnd").click()
    time.sleep(2)
    # 7 | type | css=.whsOnd | vaquan0508@gmail.com
    with open("email.txt", "r", encoding="utf-8") as f:
      emails = [line.strip() for line in f.readlines() if line.strip()]
    # print(email for email in emails)
    for email in emails:
      # self.setup_method()
      self.driver.delete_all_cookies()
      self.driver.get("https://docs.google.com/forms/d/e/1FAIpQLScfnbNpqD8HBYFvae7ImE-yTxvJnGsefKG5VXTsVkGpUYvM1A/viewform")
      time.sleep(2)
      self.driver.find_element(By.CSS_SELECTOR, ".YhQJj > .l4V7wb").click()
      time.sleep(2)
      # self.driver.find_element(By.CSS_SELECTOR, ".YhQJj > .l4V7wb").click()
      # time.sleep(2)
      input = self.driver.find_element(By.CSS_SELECTOR, ".whsOnd.zHQkBf")
      input.clear()
      input.send_keys(email)
      self.driver.execute_script("window.scrollBy(0, 220);")
      time.sleep(2)

      # Äiá»n tá»«ng cÃ¢u á»Ÿ trang 2
      print(f"Äang á»Ÿ trang 2")
      radiogroups = self.driver.find_elements(By.XPATH, "//div[@role='radiogroup']")
      print(f"Tá»•ng sá»‘ nhÃ³m tÃ¬m tháº¥y: {len(radiogroups)}")

      for i, group in enumerate(radiogroups):
          try:
              # Láº¥y táº¥t cáº£ radio trong nhÃ³m
              radios = group.find_elements(By.XPATH, ".//div[@role='radio']")
              if radios:
                # Chá»n ngáº«u nhiÃªn hoáº·c chá»n sá»‘ 5
                choice = random.randint(0, len(radios)-1)
                
                # Äiá»u kiá»‡n cÃ¡c cá»™t tuá»•i vÃ  thu nháº­p
                
                if i == 0:
                  pos_choice = [0,1]
                  choice = random.choice(pos_choice)
                elif i == 3:
                  pos_choice = [0,1,2,3]
                  choice = random.choice(pos_choice)
                # elif i == 2:
                #   choice = 3
                radio = radios[choice]

                # Cuá»™n Ä‘áº¿n pháº§n tá»­ Ä‘Ã³
                self.driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", radio)
                time.sleep(0.3)  

                

                # DÃ¹ng JavaScript Ä‘á»ƒ click máº¡nh
                self.driver.execute_script("arguments[0].click();", radio)
                print(f"âœ… ÄÃ£ chá»n Ã´ thá»© {choice+1} cho nhÃ³m {i+1}")
                time.sleep(0.3)
              else:
                  print(f"âš ï¸ KhÃ´ng tÃ¬m tháº¥y radio trong nhÃ³m {i+1}")
          except Exception as e:
              print(f"âŒ Lá»—i táº¡i nhÃ³m {i+1}: {e}")

      print("ðŸŒŸ HoÃ n táº¥t chá»n táº¥t cáº£ radio thÃ nh cÃ´ng!")
      time.sleep(3)
      # 13 | click | css=.qs41qe > .l4V7wb | 
      # self.driver.find_element(By.CSS_SELECTOR, ".YhQJj > .l4V7wb").click()
      button = self.driver.find_element(By.XPATH,"//span[contains(text(),'Tiáº¿p') or contains(text(),'Next')]")
      self.driver.execute_script("arguments[0].click();", button)
      time.sleep(3)

      # Äiá»n tá»«ng cÃ¢u á»Ÿ trang 3
      # 14 | click | css=.qs41qe > .vd3tt | CÃ¢u 1 má»¥c 1
      # Láº¥y toÃ n bá»™ nhÃ³m radio
      print(f"Äang á»Ÿ trang 3")
      radiogroups = self.driver.find_elements(By.XPATH, "//div[@role='radiogroup']")
      print(f"Tá»•ng sá»‘ nhÃ³m tÃ¬m tháº¥y: {len(radiogroups)}")

      for i, group in enumerate(radiogroups):
          try:
              # Láº¥y táº¥t cáº£ radio trong nhÃ³m
              radios = group.find_elements(By.XPATH, ".//div[@role='radio']")
              if radios:
                  # Chá»n ngáº«u nhiÃªn hoáº·c chá»n sá»‘ 5
                  choice = random.randint(2, len(radios)-1)
                  radio = radios[choice]

                  # Cuá»™n Ä‘áº¿n pháº§n tá»­ Ä‘Ã³
                  self.driver.execute_script("arguments[0].scrollIntoView({block: 'center'});", radio)
                  time.sleep(0.3)

                  # DÃ¹ng JavaScript Ä‘á»ƒ click máº¡nh
                  self.driver.execute_script("arguments[0].click();", radio)
                  print(f"âœ… ÄÃ£ chá»n Ã´ thá»© {choice+1} cho nhÃ³m {i+1}")
                  time.sleep(0.3)
              else:
                  print(f"âš ï¸ KhÃ´ng tÃ¬m tháº¥y radio trong nhÃ³m {i+1}")
          except Exception as e:
              print(f"âŒ Lá»—i táº¡i nhÃ³m {i+1}: {e}")

      print("ðŸŒŸ HoÃ n táº¥t chá»n táº¥t cáº£ radio thÃ nh cÃ´ng!")
      time.sleep(3)

      # self.driver.execute_script("window.scrollBy(0, 220);")
      
      try:
          # Thá»­ tÃ¬m nÃºt Tiáº¿p / Next trÆ°á»›c
          next_button = self.driver.find_element(By.XPATH, "//span[contains(text(),'Tiáº¿p') or contains(text(),'Next')]")
          next_button.click()
          print("â© TÃ¬m tháº¥y nÃºt Tiáº¿p/Next, click Ä‘á»ƒ qua trang tiáº¿p theo")
          time.sleep(2)
          button = self.driver.find_element(By.XPATH,"//span[contains(text(),'GÆ°Ì‰i') or contains(text(),'Submit')]")
          self.driver.execute_script("arguments[0].click();", button)
      except:
          # Náº¿u khÃ´ng cÃ³, tÃ¬m nÃºt Gá»­i / Submit
          button = self.driver.find_element(By.XPATH, "//span[contains(text(),'GÆ°Ì‰i') or contains(text(),'Submit')]")
          print("âœ… KhÃ´ng cÃ³ nÃºt Tiáº¿p/Next, click nÃºt Gá»­i/Submit")
          self.driver.execute_script("arguments[0].click();", button)

      print(f"ÄÃ£ hoÃ n thÃ nh")
      time.sleep(2)

      # 49 | click | css=.qs41qe > .l4V7wb | 
      # self.driver.find_element(By.CSS_SELECTOR, ".qs41qe > .l4V7wb").click()
      # 50 | click | css=.Y5sE8d > .l4V7wb | 
      

      # self.teardown_method()